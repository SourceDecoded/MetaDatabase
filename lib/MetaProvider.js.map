{"version":3,"sources":["../src/MetaProvider.js"],"names":["MetaProvider","user","metaTable","provider","table","decorators","obj","method","args","result","apply","Promise","resolve","queryable","reduce","promise","decorator","then","options","decoratorOptions","name","_invokeMethodAsync","_refineQueryableAsync","toArrayAsync","toArrayWithCountAsync","countAsync"],"mappings":";;;;;;;;;;IAAqBA,Y;AACjB,0BAAYC,IAAZ,EAAkBC,SAAlB,EAA6B;AAAA;;AACzB,aAAKA,SAAL,GAAiBA,SAAjB;AACA,aAAKC,QAAL,GAAgBD,UAAUE,KAAV,CAAgBD,QAAhC;AACA,aAAKE,UAAL,GAAkBH,UAAUG,UAA5B;AACA,aAAKJ,IAAL,GAAYA,IAAZ;AACH;;;;2CAEkBK,G,EAAKC,M,EAAmB;AAAA,gBAAXC,IAAW,uEAAJ,EAAI;;AACvC,gBAAIF,OAAO,IAAP,IAAe,OAAOA,IAAIC,MAAJ,CAAP,KAAuB,UAA1C,EAAsD;AAClD,oBAAIE,SAASH,IAAIC,MAAJ,EAAYG,KAAZ,CAAkBJ,GAAlB,EAAuBE,IAAvB,CAAb;;AAEA,oBAAI,EAAEC,kBAAkBE,OAApB,CAAJ,EAAkC;AAC9BF,6BAASE,QAAQC,OAAR,CAAgBH,MAAhB,CAAT;AACH;;AAED,uBAAOA,MAAP;AACH;;AAED,mBAAOE,QAAQC,OAAR,EAAP;AACH;;;8CAEqBC,S,EAAW;AAAA;;AAC7B,gBAAIZ,OAAO,KAAKA,IAAhB;AACA,mBAAO,KAAKI,UAAL,CAAgBS,MAAhB,CAAuB,UAACC,OAAD,EAAUC,SAAV,EAAwB;AAClD,uBAAOD,QAAQE,IAAR,CAAa,UAACJ,SAAD,EAAe;AAC/B,wBAAIK,UAAU,MAAKhB,SAAL,CAAeiB,gBAAf,CAAgCH,UAAUI,IAA1C,CAAd;AACA,wBAAIX,SAAS,MAAKY,kBAAL,CAAwBL,SAAxB,EAAmC,sBAAnC,EAA2D,CAACf,IAAD,EAAOY,SAAP,EAAkBK,OAAlB,CAA3D,CAAb;;AAEA,wBAAI,EAAET,kBAAkBE,OAApB,CAAJ,EAAkC;AAC9B,+BAAOA,QAAQC,OAAR,CAAgBH,MAAhB,CAAP;AACH;;AAED,2BAAOA,MAAP;AACH,iBATM,CAAP;AAUH,aAXM,EAWJE,QAAQC,OAAR,CAAgBC,SAAhB,CAXI,CAAP;AAYH;;;qCAEYA,S,EAAW;AAAA;;AACpB,gBAAIZ,OAAO,KAAKA,IAAhB;;AAEA,mBAAO,KAAKqB,qBAAL,CAA2BT,SAA3B,EAAsCI,IAAtC,CAA2C,UAACJ,SAAD,EAAe;AAC7D,uBAAO,OAAKV,QAAL,CAAcoB,YAAd,CAA2BV,SAA3B,CAAP;AACH,aAFM,CAAP;AAGH;;;8CAEqBA,S,EAAW;AAAA;;AAC7B,gBAAIZ,OAAO,KAAKA,IAAhB;;AAEA,mBAAO,KAAKqB,qBAAL,CAA2BT,SAA3B,EAAsCI,IAAtC,CAA2C,UAACJ,SAAD,EAAe;AAC7D,uBAAO,OAAKV,QAAL,CAAcqB,qBAAd,CAAoCX,SAApC,CAAP;AACH,aAFM,CAAP;AAGH;;;mCAEUA,S,EAAW;AAAA;;AAClB,gBAAIZ,OAAO,KAAKA,IAAhB;;AAEA,mBAAO,KAAKqB,qBAAL,CAA2BT,SAA3B,EAAsCI,IAAtC,CAA2C,UAACJ,SAAD,EAAe;AAC7D,uBAAO,OAAKV,QAAL,CAAcsB,UAAd,CAAyBZ,SAAzB,CAAP;AACH,aAFM,CAAP;AAGH;;;;;;kBA5DgBb,Y","file":"MetaProvider.js","sourcesContent":["export default class MetaProvider {\n    constructor(user, metaTable) {\n        this.metaTable = metaTable;\n        this.provider = metaTable.table.provider;\n        this.decorators = metaTable.decorators;\n        this.user = user;\n    }\n\n    _invokeMethodAsync(obj, method, args = []) {\n        if (obj != null && typeof obj[method] === \"function\") {\n            var result = obj[method].apply(obj, args);\n\n            if (!(result instanceof Promise)) {\n                result = Promise.resolve(result);\n            }\n\n            return result;\n        }\n\n        return Promise.resolve();\n    }\n\n    _refineQueryableAsync(queryable) {\n        let user = this.user;\n        return this.decorators.reduce((promise, decorator) => {\n            return promise.then((queryable) => {\n                let options = this.metaTable.decoratorOptions[decorator.name];\n                let result = this._invokeMethodAsync(decorator, \"refineQueryableAsync\", [user, queryable, options]);\n\n                if (!(result instanceof Promise)) {\n                    return Promise.resolve(result);\n                }\n\n                return result;\n            });\n        }, Promise.resolve(queryable));\n    }\n\n    toArrayAsync(queryable) {\n        let user = this.user;\n\n        return this._refineQueryableAsync(queryable).then((queryable) => {\n            return this.provider.toArrayAsync(queryable);\n        });\n    }\n\n    toArrayWithCountAsync(queryable) {\n        let user = this.user;\n\n        return this._refineQueryableAsync(queryable).then((queryable) => {\n            return this.provider.toArrayWithCountAsync(queryable);\n        });\n    }\n\n    countAsync(queryable) {\n        let user = this.user;\n\n        return this._refineQueryableAsync(queryable).then((queryable) => {\n            return this.provider.countAsync(queryable);\n        });\n    }\n}"]}