{"version":3,"sources":["../../src/glassApi/GlassApi.js"],"names":["supportedDrivers","supportedFilesystems","supportedDoors","options","glassPanes","glassDoors","authenticator","decorators","actions","dbDriver","Error","Object","keys","indexOf","name","_driver","forEach","action","registerAction","getEdmListAsync","then","edms","_buildPanesAsync","_openDoorsAsync","doors","door","dispose","key","version","getEdmAsync","label","addEdmAsync","edm","_buildPaneAsync","pane","map","addPane","thePane","Promise","reject","deleteEdmAsync","newEdm","updateEdmAsync","scope","api","match","table","entity","actionName","executeAsync","reduce","previous","current","resolve","getDatabaseForEdmAsync","db","fileSystem","assign","metaOptions","database","metaDatabase","paneOptions","migrationRunner","migrator","getMigrator","doorsConfig","length","console","warn","doorConfig","push"],"mappings":"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","file":"GlassApi.js","sourcesContent":["// GlassDb\n// Manages a set of GlassPanes\nimport GlassPane from \"../glassPane/GlassPane\";\nimport MigrationRunner from \"../migration/Runner\";\nimport MetaDatabase from \"../meta/Database\";\nimport MsSqlDriver from \"../dbDriver/MsSqlDriver\";\nimport SqliteDriver from \"../dbDriver/SqliteDriver\";\nimport ExpressDoor from \"../glassDoor/GlassExpressDoor\";\n\nlet supportedDrivers = {\n    \"sqlite\": SqliteDriver,\n    \"mssql\": MsSqlDriver\n};\n\nlet supportedFilesystems = {};\n\nlet supportedDoors = {\n    \"express\": ExpressDoor\n};\n\n/*\n{\n    \"dbDriver\": {\n        \"name\": \"mssql\" || \"sqlite\",\n        \"options\": {(driver-specific options)}\n    },\n    \"fileSystem\": {\n        \"name\": \"fsDriverName\",\n        \"options\": {(fs driver-specific options)}\n    },\n    \"doors\": [\n        {\n            \"name\": \"express\",\n            \"options\": {\n                \"address\":\"0.0.0.0\",\n                \"port\":\"9000\"\n            }\n        }\n    ],\n    \"authenticator\": (iAuthenticator),\n    \"actions\":[\n        {\n            \"name\":\"actionName\",\n            \"scope\": \"api\" || \"edm\" || \"table\" || \"entity\",\n            \"match\": {\n                \"edm\":\"edmName\",\n                \"version\":\"versionString\" || \"*\",\n                \"table\":\"post\"\n            },\n            \"executeAsync\":(actionOptions)\n        }\n    ]\n}\n\nactionOptions {\n    \"metaDatabase\": metaDatabase || undefined,\n    \"edm\":edm || undefined,\n    \"tableName\": \"name\" || undefined,\n    \"entity\": entity || undefined,\n    \"body\": requestBody || undefined,\n    \"query\": requestQuery || undefined,\n    \"user\": user\n}\n*/\n\nexport default class {\n    constructor(options = {}) {\n        this.glassPanes = {};\n        this.glassDoors = [];\n        this.authenticator =  options.authenticator;\n        this.decorators = options.decorators;\n        this.actions = {\"api\":{}, \"edm\":{}, \"table\":{}, \"entity\":{}};\n\n        if (!options.dbDriver) {\n            throw new Error(\"Need dbDriver info\");\n        }\n\n        let dbDriver = options.dbDriver;\n\n        if (Object.keys(supportedDrivers).indexOf(dbDriver.name) === -1) {\n            throw new Error(`Unsupported dbDriver: ${dbDriver.name}`);\n        }\n        \n        this._driver = new supportedDrivers[dbDriver.name](dbDriver.options);\n\n        options.actions.forEach((action) => {\n            this.registerAction(action);\n        });\n\n        this._driver.getEdmListAsync().then((edms) => {\n            return this._buildPanesAsync(edms);\n        }).then(() => {\n            return this._openDoorsAsync(options.doors);\n        });\n    }\n\n    dispose() {\n        this.glassDoors.forEach((door) => {\n            if (typeof door.dispose === \"function\") {\n                door.dispose();\n            }\n        });\n        \n        Object.keys(this.glassPanes).forEach((key) => {\n            this.glassPanes[key].dispose();\n        });\n    }\n\n    getEdmAsync(name, version) {\n        return this._driver.getEdmAsync(name, version);\n    }\n\n    addEdmAsync(name, version, label) {\n        return this._driver.addEdmAsync(name, version, label).then(() => {\n            return this._driver.getEdmAsync(name, version);\n        }).then((edm) => {\n            return this._buildPaneAsync(edm);\n        }).then((pane) => {\n            Object.keys(this.glassDoors).map((key) => this.glassDoors[key]).forEach((door) => {\n                door.addPane(pane);\n            });\n        });\n    }\n\n    deleteEdmAsync(name, version) {\n        let thePane = this.glassPanes[name + version];\n        if (!thePane) {\n            return Promise.reject(`Not an active EDM: ${name} ${version}`);\n        }\n        return this._driver.deleteEdmAsync(name, version).then(() => {\n            this.glassPanes[name + version].dispose();\n            delete this.glassPanes[name + version];\n        });\n    }\n\n    updateEdmAsync(newEdm) {\n        let {name, version} = newEdm;\n        let thePane = this.glassPanes[name + version];\n        if (!thePane) {\n            return Promise.reject(`Not an active EDM: ${name} ${version}`);\n        }\n        return this._driver.updateEdmAsync(newEdm);\n    }\n\n    registerAction(action) {\n        if (action.scope === \"api\") {\n            this.actions.api[action.name] = action;\n        } else if (action.scope === \"edm\") {\n            this.actions.edm[action.match.edm] = this.actions.edm[action.match.edm] || {};\n            this.actions.edm[action.match.edm][action.match.version] = this.actions.edm[action.match.edm][action.match.version] || {};\n            this.actions.edm[action.match.edm][action.match.version].edm[action.name] = action;\n        } else if (action.scope === \"table\") {\n            this.actions.table[action.match.edm] = this.actions.table[action.match.edm] || {};\n            this.actions.table[action.match.edm][action.match.version] = this.actions.table[action.match.edm][action.match.version] || {};\n            this.actions.table[action.match.edm][action.match.version][action.match.table] = this.actions.table[action.match.edm][action.match.version][action.match.table] || {};\n            this.actions.table[action.match.edm][action.match.version][action.match.table][action.name] = action;\n        } else if (action.scope === \"entity\") {\n            this.actions.entity[action.match.edm] = this.actions.table[action.match.edm] || {};\n            this.actions.entity[action.match.edm][action.match.version] = this.actions.entity[action.match.edm][action.match.version] || {};\n            this.actions.entity[action.match.edm][action.match.version][action.match.table] = this.actions.entity[action.match.edm][action.match.version][action.match.table] || {};\n            this.actions.entity[action.match.edm][action.match.version][action.match.table][action.name] = action;\n        }\n    }\n\n    executeApiActionAsync(actionName, options) {\n        if (!this.actions.api[actionName]) {\n            return Promise.reject(\"API action not found: \" + actionName);\n        }\n        return this.actions.api[actionName].executeAsync(options);\n    }\n\n    _buildPanesAsync(edms) {\n        return edms.reduce((previous, current) => {\n            return previous.then(() => {\n                return this._buildPaneAsync(current);\n            });\n        }, Promise.resolve());\n    }\n\n    _buildPaneAsync(edm) {\n        return this._driver.getDatabaseForEdmAsync(edm).then((db) => {\n            // TODO: instantiate filesystem\n            let fileSystem = {};\n\n            let actions = {\"edm\":{}, \"table\":{}, \"entity\":{}};\n\n            if (this.actions.edm[edm.name] && this.actions.edm[edm.name][edm.version]) {\n                Object.assign(actions.edm, this.actions.edm[edm.name][edm.version]);\n            }\n            if (this.actions.edm[edm.name] && this.actions.edm[edm.name][\"*\"]) {\n                Object.assign(actions.edm, this.actions.edm[edm.name][\"*\"]);\n            }\n\n            if (this.actions.table[edm.name] && this.actions.table[edm.name][edm.version]) {\n                Object.assign(actions.table, this.actions.table[edm.name][edm.version]);\n            }\n            if (this.actions.table[edm.name] && this.actions.table[edm.name][\"*\"]) {\n                Object.assign(actions.table, this.actions.table[edm.name][\"*\"]);\n            }\n\n            if (this.actions.entity[edm.name] && this.actions.entity[edm.name][edm.version]) {\n                Object.assign(actions.entity, this.actions.entity[edm.name][edm.version]);\n            }\n            if (this.actions.entity[edm.name] && this.actions.entity[edm.name][\"*\"]) {\n                Object.assign(actions.entity, this.actions.entity[edm.name][\"*\"]);\n            }\n\n            let metaOptions = {\n                database: db,\n                decorators: this.decorators,\n                fileSystem: fileSystem\n            };\n\n            let metaDatabase = new MetaDatabase(metaOptions);\n\n            let paneOptions = {\n                metaDatabase: metaDatabase,\n                migrationRunner: new MigrationRunner({edm:edm, migrator: db.getMigrator()}),\n                edm: edm,\n                actions: actions\n            };\n\n            let pane = new GlassPane(paneOptions);\n            this.glassPanes[edm.name + edm.version] = pane;\n            return pane; \n        });\n    }\n\n    _openDoorsAsync(doorsConfig) {\n        if (doorsConfig.length === 0) {\n            console.warn(\"GlassDB is running, but there is no way to access it. Include one or more doors in the options.\");\n        }\n        doorsConfig.forEach((doorConfig) => {\n            doorConfig.options['glass'] = this;\n            let door = new supportedDoors[doorConfig.name](doorConfig.options);\n            Object.keys(this.glassPanes).map((key) => this.glassPanes[key]).forEach((pane) => {\n                door.addPane(pane);\n            });\n            this.glassDoors.push(door);\n        });\n    }\n\n}"]}