{"version":3,"sources":["../../src/glassApi/GlassApi.js"],"names":["supportedDrivers","supportedFileSystems","supportedDoors","options","glassPanes","glassDoors","authenticator","decorators","actions","dbDriver","Error","Object","keys","indexOf","name","_driver","_fileSystem","fileSystem","forEach","action","registerAction","getEdmListAsync","then","edms","_buildPanesAsync","_openDoorsAsync","doors","emit","catch","error","door","dispose","key","version","getEdmAsync","label","addEdmAsync","edm","_buildPaneAsync","pane","map","addPane","thePane","Promise","reject","deleteEdmAsync","newEdm","updateEdmAsync","scope","api","match","table","entity","actionName","executeAsync","reduce","previous","current","resolve","getDatabaseForEdmAsync","db","assign","metaOptions","database","metaDatabase","paneOptions","migrationRunner","migrator","getMigrator","doorsConfig","length","console","warn","doorConfig","push"],"mappings":";;;;;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;+eATA;AACA;;;AAUA,IAAIA,mBAAmB;AACnB,oCADmB;AAEnB;AAFmB,CAAvB;;AAKA,IAAIC,uBAAuB;AACvB;AADuB,CAA3B;;AAIA,IAAIC,iBAAiB;AACjB;AADiB,CAArB;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CI,sBAA0B;AAAA,YAAdC,OAAc,uEAAJ,EAAI;;AAAA;;AAAA;;AAEtB,cAAKC,UAAL,GAAkB,EAAlB;AACA,cAAKC,UAAL,GAAkB,EAAlB;AACA,cAAKC,aAAL,GAAsBH,QAAQG,aAA9B;AACA,cAAKC,UAAL,GAAkBJ,QAAQI,UAAR,IAAsB,EAAxC;AACA,cAAKC,OAAL,GAAe,EAAC,OAAM,EAAP,EAAW,OAAM,EAAjB,EAAqB,SAAQ,EAA7B,EAAiC,UAAS,EAA1C,EAAf;;AAEA,YAAI,CAACL,QAAQM,QAAb,EAAuB;AACnB,kBAAM,IAAIC,KAAJ,CAAU,oBAAV,CAAN;AACH;;AAED,YAAID,WAAWN,QAAQM,QAAvB;;AAEA,YAAIE,OAAOC,IAAP,CAAYZ,gBAAZ,EAA8Ba,OAA9B,CAAsCJ,SAASK,IAA/C,MAAyD,CAAC,CAA9D,EAAiE;AAC7D,kBAAM,IAAIJ,KAAJ,4BAAmCD,SAASK,IAA5C,CAAN;AACH;;AAED,cAAKC,OAAL,GAAe,IAAIf,iBAAiBS,SAASK,IAA1B,CAAJ,CAAoCL,SAASN,OAA7C,CAAf;;AAEA,cAAKa,WAAL,GAAmB,IAAIf,qBAAqBE,QAAQc,UAAR,CAAmBH,IAAxC,CAAJ,CAAkDX,QAAQc,UAAR,CAAmBd,OAArE,CAAnB;;AAEA,YAAIA,QAAQK,OAAZ,EAAqB;AACjBL,oBAAQK,OAAR,CAAgBU,OAAhB,CAAwB,UAACC,MAAD,EAAY;AAChC,sBAAKC,cAAL,CAAoBD,MAApB;AACH,aAFD;AAGH;;AAED,cAAKJ,OAAL,CAAaM,eAAb,GAA+BC,IAA/B,CAAoC,UAACC,IAAD,EAAU;AAC1C,mBAAO,MAAKC,gBAAL,CAAsBD,IAAtB,CAAP;AACH,SAFD,EAEGD,IAFH,CAEQ,YAAM;AACV,mBAAO,MAAKG,eAAL,CAAqBtB,QAAQuB,KAA7B,CAAP;AACH,SAJD,EAIGJ,IAJH,CAIQ,YAAM;AACV,kBAAKK,IAAL,CAAU,OAAV;AACH,SAND,EAMGC,KANH,CAMS,UAACC,KAAD,EAAW;AAChB,kBAAKF,IAAL,CAAU,OAAV,EAAmBE,KAAnB;AACH,SARD;AA5BsB;AAqCzB;;;;kCAES;AAAA;;AACN,iBAAKxB,UAAL,CAAgBa,OAAhB,CAAwB,UAACY,IAAD,EAAU;AAC9B,oBAAI,OAAOA,KAAKC,OAAZ,KAAwB,UAA5B,EAAwC;AACpCD,yBAAKC,OAAL;AACH;AACJ,aAJD;;AAMApB,mBAAOC,IAAP,CAAY,KAAKR,UAAjB,EAA6Bc,OAA7B,CAAqC,UAACc,GAAD,EAAS;AAC1C,uBAAK5B,UAAL,CAAgB4B,GAAhB,EAAqBD,OAArB;AACH,aAFD;AAGH;;;oCAEWjB,I,EAAMmB,O,EAAS;AACvB,mBAAO,KAAKlB,OAAL,CAAamB,WAAb,CAAyBpB,IAAzB,EAA+BmB,OAA/B,CAAP;AACH;;;oCAEWnB,I,EAAMmB,O,EAASE,K,EAAO;AAAA;;AAC9B,mBAAO,KAAKpB,OAAL,CAAaqB,WAAb,CAAyBtB,IAAzB,EAA+BmB,OAA/B,EAAwCE,KAAxC,EAA+Cb,IAA/C,CAAoD,YAAM;AAC7D,uBAAO,OAAKP,OAAL,CAAamB,WAAb,CAAyBpB,IAAzB,EAA+BmB,OAA/B,CAAP;AACH,aAFM,EAEJX,IAFI,CAEC,UAACe,GAAD,EAAS;AACb,uBAAO,OAAKC,eAAL,CAAqBD,GAArB,CAAP;AACH,aAJM,EAIJf,IAJI,CAIC,UAACiB,IAAD,EAAU;AACd5B,uBAAOC,IAAP,CAAY,OAAKP,UAAjB,EAA6BmC,GAA7B,CAAiC,UAACR,GAAD;AAAA,2BAAS,OAAK3B,UAAL,CAAgB2B,GAAhB,CAAT;AAAA,iBAAjC,EAAgEd,OAAhE,CAAwE,UAACY,IAAD,EAAU;AAC9EA,yBAAKW,OAAL,CAAaF,IAAb;AACH,iBAFD;AAGH,aARM,CAAP;AASH;;;uCAEczB,I,EAAMmB,O,EAAS;AAAA;;AAC1B,gBAAIS,UAAU,KAAKtC,UAAL,CAAgBU,OAAOmB,OAAvB,CAAd;AACA,gBAAI,CAACS,OAAL,EAAc;AACV,uBAAOC,QAAQC,MAAR,yBAAqC9B,IAArC,SAA6CmB,OAA7C,CAAP;AACH;AACD,mBAAO,KAAKlB,OAAL,CAAa8B,cAAb,CAA4B/B,IAA5B,EAAkCmB,OAAlC,EAA2CX,IAA3C,CAAgD,YAAM;AACzD,uBAAKlB,UAAL,CAAgBU,OAAOmB,OAAvB,EAAgCF,OAAhC;AACA,uBAAO,OAAK3B,UAAL,CAAgBU,OAAOmB,OAAvB,CAAP;AACH,aAHM,CAAP;AAIH;;;uCAEca,M,EAAQ;AAAA,gBACdhC,IADc,GACGgC,MADH,CACdhC,IADc;AAAA,gBACRmB,OADQ,GACGa,MADH,CACRb,OADQ;;AAEnB,gBAAIS,UAAU,KAAKtC,UAAL,CAAgBU,OAAOmB,OAAvB,CAAd;AACA,gBAAI,CAACS,OAAL,EAAc;AACV,uBAAOC,QAAQC,MAAR,yBAAqC9B,IAArC,SAA6CmB,OAA7C,CAAP;AACH;AACD,mBAAO,KAAKlB,OAAL,CAAagC,cAAb,CAA4BD,MAA5B,CAAP;AACH;;;uCAEc3B,M,EAAQ;AACnB,gBAAIA,OAAO6B,KAAP,KAAiB,KAArB,EAA4B;AACxB,qBAAKxC,OAAL,CAAayC,GAAb,CAAiB9B,OAAOL,IAAxB,IAAgCK,MAAhC;AACH,aAFD,MAEO,IAAIA,OAAO6B,KAAP,KAAiB,KAArB,EAA4B;AAC/B,qBAAKxC,OAAL,CAAa6B,GAAb,CAAiBlB,OAAO+B,KAAP,CAAab,GAA9B,IAAqC,KAAK7B,OAAL,CAAa6B,GAAb,CAAiBlB,OAAO+B,KAAP,CAAab,GAA9B,KAAsC,EAA3E;AACA,qBAAK7B,OAAL,CAAa6B,GAAb,CAAiBlB,OAAO+B,KAAP,CAAab,GAA9B,EAAmClB,OAAO+B,KAAP,CAAajB,OAAhD,IAA2D,KAAKzB,OAAL,CAAa6B,GAAb,CAAiBlB,OAAO+B,KAAP,CAAab,GAA9B,EAAmClB,OAAO+B,KAAP,CAAajB,OAAhD,KAA4D,EAAvH;AACA,qBAAKzB,OAAL,CAAa6B,GAAb,CAAiBlB,OAAO+B,KAAP,CAAab,GAA9B,EAAmClB,OAAO+B,KAAP,CAAajB,OAAhD,EAAyDd,OAAOL,IAAhE,IAAwEK,MAAxE;AACH,aAJM,MAIA,IAAIA,OAAO6B,KAAP,KAAiB,OAArB,EAA8B;AACjC,qBAAKxC,OAAL,CAAa2C,KAAb,CAAmBhC,OAAO+B,KAAP,CAAab,GAAhC,IAAuC,KAAK7B,OAAL,CAAa2C,KAAb,CAAmBhC,OAAO+B,KAAP,CAAab,GAAhC,KAAwC,EAA/E;AACA,qBAAK7B,OAAL,CAAa2C,KAAb,CAAmBhC,OAAO+B,KAAP,CAAab,GAAhC,EAAqClB,OAAO+B,KAAP,CAAajB,OAAlD,IAA6D,KAAKzB,OAAL,CAAa2C,KAAb,CAAmBhC,OAAO+B,KAAP,CAAab,GAAhC,EAAqClB,OAAO+B,KAAP,CAAajB,OAAlD,KAA8D,EAA3H;AACA,qBAAKzB,OAAL,CAAa2C,KAAb,CAAmBhC,OAAO+B,KAAP,CAAab,GAAhC,EAAqClB,OAAO+B,KAAP,CAAajB,OAAlD,EAA2Dd,OAAO+B,KAAP,CAAaC,KAAxE,IAAiF,KAAK3C,OAAL,CAAa2C,KAAb,CAAmBhC,OAAO+B,KAAP,CAAab,GAAhC,EAAqClB,OAAO+B,KAAP,CAAajB,OAAlD,EAA2Dd,OAAO+B,KAAP,CAAaC,KAAxE,KAAkF,EAAnK;AACA,qBAAK3C,OAAL,CAAa2C,KAAb,CAAmBhC,OAAO+B,KAAP,CAAab,GAAhC,EAAqClB,OAAO+B,KAAP,CAAajB,OAAlD,EAA2Dd,OAAO+B,KAAP,CAAaC,KAAxE,EAA+EhC,OAAOL,IAAtF,IAA8FK,MAA9F;AACH,aALM,MAKA,IAAIA,OAAO6B,KAAP,KAAiB,QAArB,EAA+B;AAClC,qBAAKxC,OAAL,CAAa4C,MAAb,CAAoBjC,OAAO+B,KAAP,CAAab,GAAjC,IAAwC,KAAK7B,OAAL,CAAa2C,KAAb,CAAmBhC,OAAO+B,KAAP,CAAab,GAAhC,KAAwC,EAAhF;AACA,qBAAK7B,OAAL,CAAa4C,MAAb,CAAoBjC,OAAO+B,KAAP,CAAab,GAAjC,EAAsClB,OAAO+B,KAAP,CAAajB,OAAnD,IAA8D,KAAKzB,OAAL,CAAa4C,MAAb,CAAoBjC,OAAO+B,KAAP,CAAab,GAAjC,EAAsClB,OAAO+B,KAAP,CAAajB,OAAnD,KAA+D,EAA7H;AACA,qBAAKzB,OAAL,CAAa4C,MAAb,CAAoBjC,OAAO+B,KAAP,CAAab,GAAjC,EAAsClB,OAAO+B,KAAP,CAAajB,OAAnD,EAA4Dd,OAAO+B,KAAP,CAAaC,KAAzE,IAAkF,KAAK3C,OAAL,CAAa4C,MAAb,CAAoBjC,OAAO+B,KAAP,CAAab,GAAjC,EAAsClB,OAAO+B,KAAP,CAAajB,OAAnD,EAA4Dd,OAAO+B,KAAP,CAAaC,KAAzE,KAAmF,EAArK;AACA,qBAAK3C,OAAL,CAAa4C,MAAb,CAAoBjC,OAAO+B,KAAP,CAAab,GAAjC,EAAsClB,OAAO+B,KAAP,CAAajB,OAAnD,EAA4Dd,OAAO+B,KAAP,CAAaC,KAAzE,EAAgFhC,OAAOL,IAAvF,IAA+FK,MAA/F;AACH;AACJ;;;8CAEqBkC,U,EAAYlD,O,EAAS;AACvC,gBAAI,CAAC,KAAKK,OAAL,CAAayC,GAAb,CAAiBI,UAAjB,CAAL,EAAmC;AAC/B,uBAAOV,QAAQC,MAAR,CAAe,2BAA2BS,UAA1C,CAAP;AACH;AACD,mBAAO,KAAK7C,OAAL,CAAayC,GAAb,CAAiBI,UAAjB,EAA6BC,YAA7B,CAA0CnD,OAA1C,CAAP;AACH;;;yCAEgBoB,I,EAAM;AAAA;;AACnB,mBAAOA,KAAKgC,MAAL,CAAY,UAACC,QAAD,EAAWC,OAAX,EAAuB;AACtC,uBAAOD,SAASlC,IAAT,CAAc,YAAM;AACvB,2BAAO,OAAKgB,eAAL,CAAqBmB,OAArB,CAAP;AACH,iBAFM,CAAP;AAGH,aAJM,EAIJd,QAAQe,OAAR,EAJI,CAAP;AAKH;;;wCAEerB,G,EAAK;AAAA;;AACjB,mBAAO,KAAKtB,OAAL,CAAa4C,sBAAb,CAAoCtB,GAApC,EAAyCf,IAAzC,CAA8C,UAACsC,EAAD,EAAQ;AACzD,oBAAIpD,UAAU,EAAC,OAAM,EAAP,EAAW,SAAQ,EAAnB,EAAuB,UAAS,EAAhC,EAAd;;AAEA,oBAAI,OAAKA,OAAL,CAAa6B,GAAb,CAAiBA,IAAIvB,IAArB,KAA8B,OAAKN,OAAL,CAAa6B,GAAb,CAAiBA,IAAIvB,IAArB,EAA2BuB,IAAIJ,OAA/B,CAAlC,EAA2E;AACvEtB,2BAAOkD,MAAP,CAAcrD,QAAQ6B,GAAtB,EAA2B,OAAK7B,OAAL,CAAa6B,GAAb,CAAiBA,IAAIvB,IAArB,EAA2BuB,IAAIJ,OAA/B,CAA3B;AACH;AACD,oBAAI,OAAKzB,OAAL,CAAa6B,GAAb,CAAiBA,IAAIvB,IAArB,KAA8B,OAAKN,OAAL,CAAa6B,GAAb,CAAiBA,IAAIvB,IAArB,EAA2B,GAA3B,CAAlC,EAAmE;AAC/DH,2BAAOkD,MAAP,CAAcrD,QAAQ6B,GAAtB,EAA2B,OAAK7B,OAAL,CAAa6B,GAAb,CAAiBA,IAAIvB,IAArB,EAA2B,GAA3B,CAA3B;AACH;;AAED,oBAAI,OAAKN,OAAL,CAAa2C,KAAb,CAAmBd,IAAIvB,IAAvB,KAAgC,OAAKN,OAAL,CAAa2C,KAAb,CAAmBd,IAAIvB,IAAvB,EAA6BuB,IAAIJ,OAAjC,CAApC,EAA+E;AAC3EtB,2BAAOkD,MAAP,CAAcrD,QAAQ2C,KAAtB,EAA6B,OAAK3C,OAAL,CAAa2C,KAAb,CAAmBd,IAAIvB,IAAvB,EAA6BuB,IAAIJ,OAAjC,CAA7B;AACH;AACD,oBAAI,OAAKzB,OAAL,CAAa2C,KAAb,CAAmBd,IAAIvB,IAAvB,KAAgC,OAAKN,OAAL,CAAa2C,KAAb,CAAmBd,IAAIvB,IAAvB,EAA6B,GAA7B,CAApC,EAAuE;AACnEH,2BAAOkD,MAAP,CAAcrD,QAAQ2C,KAAtB,EAA6B,OAAK3C,OAAL,CAAa2C,KAAb,CAAmBd,IAAIvB,IAAvB,EAA6B,GAA7B,CAA7B;AACH;;AAED,oBAAI,OAAKN,OAAL,CAAa4C,MAAb,CAAoBf,IAAIvB,IAAxB,KAAiC,OAAKN,OAAL,CAAa4C,MAAb,CAAoBf,IAAIvB,IAAxB,EAA8BuB,IAAIJ,OAAlC,CAArC,EAAiF;AAC7EtB,2BAAOkD,MAAP,CAAcrD,QAAQ4C,MAAtB,EAA8B,OAAK5C,OAAL,CAAa4C,MAAb,CAAoBf,IAAIvB,IAAxB,EAA8BuB,IAAIJ,OAAlC,CAA9B;AACH;AACD,oBAAI,OAAKzB,OAAL,CAAa4C,MAAb,CAAoBf,IAAIvB,IAAxB,KAAiC,OAAKN,OAAL,CAAa4C,MAAb,CAAoBf,IAAIvB,IAAxB,EAA8B,GAA9B,CAArC,EAAyE;AACrEH,2BAAOkD,MAAP,CAAcrD,QAAQ4C,MAAtB,EAA8B,OAAK5C,OAAL,CAAa4C,MAAb,CAAoBf,IAAIvB,IAAxB,EAA8B,GAA9B,CAA9B;AACH;;AAED,oBAAIgD,cAAc;AACdC,8BAAUH,EADI;AAEdrD,gCAAY,OAAKA,UAFH;AAGdU,gCAAY,OAAKD;AAHH,iBAAlB;;AAMA,oBAAIgD,eAAe,uBAAiBF,WAAjB,CAAnB;;AAEA,oBAAIG,cAAc;AACdD,kCAAcA,YADA;AAEdE,qCAAiB,qBAAoB,EAAC7B,KAAIA,GAAL,EAAU8B,UAAUP,GAAGQ,WAAH,CAAeJ,YAAf,CAApB,EAApB,CAFH;AAGd3B,yBAAKA,GAHS;AAId7B,6BAASA;AAJK,iBAAlB;;AAOA,oBAAI+B,OAAO,wBAAc0B,WAAd,CAAX;AACA,uBAAK7D,UAAL,CAAgBiC,IAAIvB,IAAJ,GAAWuB,IAAIJ,OAA/B,IAA0CM,IAA1C;AACA,uBAAOA,IAAP;AACH,aA1CM,CAAP;AA2CH;;;0CAEiC;AAAA;;AAAA,gBAAlB8B,WAAkB,uEAAJ,EAAI;;AAC9B,gBAAIA,YAAYC,MAAZ,KAAuB,CAA3B,EAA8B;AAC1BC,wBAAQC,IAAR,CAAa,iGAAb;AACH;AACDH,wBAAYnD,OAAZ,CAAoB,UAACuD,UAAD,EAAgB;AAChCA,2BAAWtE,OAAX,CAAmB,OAAnB;AACA,oBAAI2B,OAAO,IAAI5B,eAAeuE,WAAW3D,IAA1B,CAAJ,CAAoC2D,WAAWtE,OAA/C,CAAX;AACAQ,uBAAOC,IAAP,CAAY,OAAKR,UAAjB,EAA6BoC,GAA7B,CAAiC,UAACR,GAAD;AAAA,2BAAS,OAAK5B,UAAL,CAAgB4B,GAAhB,CAAT;AAAA,iBAAjC,EAAgEd,OAAhE,CAAwE,UAACqB,IAAD,EAAU;AAC9ET,yBAAKW,OAAL,CAAaF,IAAb;AACH,iBAFD;AAGA,uBAAKlC,UAAL,CAAgBqE,IAAhB,CAAqB5C,IAArB;AACH,aAPD;AAQH","file":"GlassApi.js","sourcesContent":["// GlassDb\n// Manages a set of GlassPanes\nimport GlassPane from \"../glassPane/GlassPane\";\nimport MigrationRunner from \"../migration/Runner\";\nimport MetaDatabase from \"../meta/Database\";\nimport MsSqlDriver from \"../dbDriver/MsSqlDriver\";\nimport SqliteDriver from \"../dbDriver/SqliteDriver\";\nimport ExpressDoor from \"../glassDoor/GlassExpressDoor\";\nimport LocalFileSystem from \"../util/LocalFileSystem\";\nimport EventEmitter from \"events\";\n\nlet supportedDrivers = {\n    \"sqlite\": SqliteDriver,\n    \"mssql\": MsSqlDriver\n};\n\nlet supportedFileSystems = {\n    \"localFileSystem\": LocalFileSystem\n};\n\nlet supportedDoors = {\n    \"express\": ExpressDoor\n};\n\n/*\n{\n    \"dbDriver\": {\n        \"name\": \"mssql\" || \"sqlite\",\n        \"options\": {(driver-specific options)}\n    },\n    \"fileSystem\": {\n        \"name\": \"fsDriverName\",\n        \"options\": {(fs driver-specific options)}\n    },\n    \"doors\": [\n        {\n            \"name\": \"express\",\n            \"options\": {\n                \"address\":\"0.0.0.0\",\n                \"port\":\"9000\"\n            }\n        }\n    ],\n    \"authenticator\": (iAuthenticator),\n    \"actions\":[\n        {\n            \"name\":\"actionName\",\n            \"scope\": \"api\" || \"edm\" || \"table\" || \"entity\",\n            \"match\": {\n                \"edm\":\"edmName\",\n                \"version\":\"versionString\" || \"*\",\n                \"table\":\"post\"\n            },\n            \"executeAsync\":(actionOptions)\n        }\n    ]\n}\n\nactionOptions {\n    \"metaDatabase\": metaDatabase || undefined,\n    \"edm\":edm || undefined,\n    \"tableName\": \"name\" || undefined,\n    \"entity\": entity || undefined,\n    \"body\": requestBody || undefined,\n    \"query\": requestQuery || undefined,\n    \"user\": user\n}\n*/\n\nexport default class extends EventEmitter {\n    constructor(options = {}) {\n        super();\n        this.glassPanes = {};\n        this.glassDoors = [];\n        this.authenticator =  options.authenticator;\n        this.decorators = options.decorators || [];\n        this.actions = {\"api\":{}, \"edm\":{}, \"table\":{}, \"entity\":{}};\n\n        if (!options.dbDriver) {\n            throw new Error(\"Need dbDriver info\");\n        }\n\n        let dbDriver = options.dbDriver;\n\n        if (Object.keys(supportedDrivers).indexOf(dbDriver.name) === -1) {\n            throw new Error(`Unsupported dbDriver: ${dbDriver.name}`);\n        }\n        \n        this._driver = new supportedDrivers[dbDriver.name](dbDriver.options);\n\n        this._fileSystem = new supportedFileSystems[options.fileSystem.name](options.fileSystem.options);\n\n        if (options.actions) {\n            options.actions.forEach((action) => {\n                this.registerAction(action);\n            });\n        }\n        \n        this._driver.getEdmListAsync().then((edms) => {\n            return this._buildPanesAsync(edms);\n        }).then(() => {\n            return this._openDoorsAsync(options.doors);\n        }).then(() => {\n            this.emit(\"ready\");\n        }).catch((error) => {\n            this.emit(\"error\", error);\n        });\n    }\n\n    dispose() {\n        this.glassDoors.forEach((door) => {\n            if (typeof door.dispose === \"function\") {\n                door.dispose();\n            }\n        });\n        \n        Object.keys(this.glassPanes).forEach((key) => {\n            this.glassPanes[key].dispose();\n        });\n    }\n\n    getEdmAsync(name, version) {\n        return this._driver.getEdmAsync(name, version);\n    }\n\n    addEdmAsync(name, version, label) {\n        return this._driver.addEdmAsync(name, version, label).then(() => {\n            return this._driver.getEdmAsync(name, version);\n        }).then((edm) => {\n            return this._buildPaneAsync(edm);\n        }).then((pane) => {\n            Object.keys(this.glassDoors).map((key) => this.glassDoors[key]).forEach((door) => {\n                door.addPane(pane);\n            });\n        });\n    }\n\n    deleteEdmAsync(name, version) {\n        let thePane = this.glassPanes[name + version];\n        if (!thePane) {\n            return Promise.reject(`Not an active EDM: ${name} ${version}`);\n        }\n        return this._driver.deleteEdmAsync(name, version).then(() => {\n            this.glassPanes[name + version].dispose();\n            delete this.glassPanes[name + version];\n        });\n    }\n\n    updateEdmAsync(newEdm) {\n        let {name, version} = newEdm;\n        let thePane = this.glassPanes[name + version];\n        if (!thePane) {\n            return Promise.reject(`Not an active EDM: ${name} ${version}`);\n        }\n        return this._driver.updateEdmAsync(newEdm);\n    }\n\n    registerAction(action) {\n        if (action.scope === \"api\") {\n            this.actions.api[action.name] = action;\n        } else if (action.scope === \"edm\") {\n            this.actions.edm[action.match.edm] = this.actions.edm[action.match.edm] || {};\n            this.actions.edm[action.match.edm][action.match.version] = this.actions.edm[action.match.edm][action.match.version] || {};\n            this.actions.edm[action.match.edm][action.match.version][action.name] = action;\n        } else if (action.scope === \"table\") {\n            this.actions.table[action.match.edm] = this.actions.table[action.match.edm] || {};\n            this.actions.table[action.match.edm][action.match.version] = this.actions.table[action.match.edm][action.match.version] || {};\n            this.actions.table[action.match.edm][action.match.version][action.match.table] = this.actions.table[action.match.edm][action.match.version][action.match.table] || {};\n            this.actions.table[action.match.edm][action.match.version][action.match.table][action.name] = action;\n        } else if (action.scope === \"entity\") {\n            this.actions.entity[action.match.edm] = this.actions.table[action.match.edm] || {};\n            this.actions.entity[action.match.edm][action.match.version] = this.actions.entity[action.match.edm][action.match.version] || {};\n            this.actions.entity[action.match.edm][action.match.version][action.match.table] = this.actions.entity[action.match.edm][action.match.version][action.match.table] || {};\n            this.actions.entity[action.match.edm][action.match.version][action.match.table][action.name] = action;\n        }\n    }\n\n    executeApiActionAsync(actionName, options) {\n        if (!this.actions.api[actionName]) {\n            return Promise.reject(\"API action not found: \" + actionName);\n        }\n        return this.actions.api[actionName].executeAsync(options);\n    }\n\n    _buildPanesAsync(edms) {\n        return edms.reduce((previous, current) => {\n            return previous.then(() => {\n                return this._buildPaneAsync(current);\n            });\n        }, Promise.resolve());\n    }\n\n    _buildPaneAsync(edm) {\n        return this._driver.getDatabaseForEdmAsync(edm).then((db) => {\n            let actions = {\"edm\":{}, \"table\":{}, \"entity\":{}};\n\n            if (this.actions.edm[edm.name] && this.actions.edm[edm.name][edm.version]) {\n                Object.assign(actions.edm, this.actions.edm[edm.name][edm.version]);\n            }\n            if (this.actions.edm[edm.name] && this.actions.edm[edm.name][\"*\"]) {\n                Object.assign(actions.edm, this.actions.edm[edm.name][\"*\"]);\n            }\n\n            if (this.actions.table[edm.name] && this.actions.table[edm.name][edm.version]) {\n                Object.assign(actions.table, this.actions.table[edm.name][edm.version]);\n            }\n            if (this.actions.table[edm.name] && this.actions.table[edm.name][\"*\"]) {\n                Object.assign(actions.table, this.actions.table[edm.name][\"*\"]);\n            }\n\n            if (this.actions.entity[edm.name] && this.actions.entity[edm.name][edm.version]) {\n                Object.assign(actions.entity, this.actions.entity[edm.name][edm.version]);\n            }\n            if (this.actions.entity[edm.name] && this.actions.entity[edm.name][\"*\"]) {\n                Object.assign(actions.entity, this.actions.entity[edm.name][\"*\"]);\n            }\n\n            let metaOptions = {\n                database: db,\n                decorators: this.decorators,\n                fileSystem: this._fileSystem\n            };\n\n            let metaDatabase = new MetaDatabase(metaOptions);\n\n            let paneOptions = {\n                metaDatabase: metaDatabase,\n                migrationRunner: new MigrationRunner({edm:edm, migrator: db.getMigrator(metaDatabase)}),\n                edm: edm,\n                actions: actions\n            };\n\n            let pane = new GlassPane(paneOptions);\n            this.glassPanes[edm.name + edm.version] = pane;\n            return pane; \n        });\n    }\n\n    _openDoorsAsync(doorsConfig = []) {\n        if (doorsConfig.length === 0) {\n            console.warn(\"GlassDB is running, but there is no way to access it. Include one or more doors in the options.\");\n        }\n        doorsConfig.forEach((doorConfig) => {\n            doorConfig.options['glass'] = this;\n            let door = new supportedDoors[doorConfig.name](doorConfig.options);\n            Object.keys(this.glassPanes).map((key) => this.glassPanes[key]).forEach((pane) => {\n                door.addPane(pane);\n            });\n            this.glassDoors.push(door);\n        });\n    }\n\n}"]}