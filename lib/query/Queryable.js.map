{"version":3,"sources":["../../src/query/Queryable.js"],"names":["assertHasProvider","queryable","provider","Error","copyQuery","copy","where","query","orderBy","include","parameters","JSON","parse","stringify","take","skip","Queryable","Type","Object","nodeName","Infinity","lambda","rightExpression","getQuery","call","children","length","push","leftExpression","pop","or","and","value","propertyExpression","getExpression","descendingExpression","descending","contains","ascendingExpression","ascending","params","keys","forEach","key","expression","clone","cloneQuery","executeAsync","guid","constant","onEach","toArrayAsync","then","results","countAsync","toArrayWithCountAsync","allAsync","anyAsync","firstOrDefaultAsync","firstAsync","lastAsync","selectAsync","containsAsync","callback","count","a","compareToQueryable","Array","asQueryable","intersectsAsync"],"mappings":"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","file":"Queryable.js","sourcesContent":["import { Expression, ValueExpression, OperationExpression } from \"./Expression\";\nimport { ExpressionBuilder, OperationExpressionBuilder } from \"./ExpressionBuilder\";\n\nconst assertHasProvider = queryable => {\n    if (!queryable.provider) {\n        throw new Error(\"No provider found.\");\n    }\n};\n\nconst copyQuery = query => {\n    var copy = {};\n\n    copy.where = query.where.copy();\n    copy.orderBy = query.orderBy.copy();\n    copy.include = query.include.copy();\n    copy.parameters = JSON.parse(JSON.stringify(query.parameters));\n    copy.take = query.take;\n    copy.skip = query.skip;\n\n    return copy;\n};\n\nexport default class Queryable {\n    constructor(Type, query) {\n        query = query || {};\n\n        this.Type = Type || Object;\n        this.provider = null;\n        this.query = {};\n        this.query.parameters = (query && query.parameters) || {};\n\n        if (query.where != null && query.where.nodeName === \"where\") {\n            this.query.where = query.where;\n        } else {\n            this.query.where = Expression.where();\n        }\n\n        if (query.skip != null && query.skip.nodeName === \"skip\") {\n            this.query.skip = query.skip;\n        } else {\n            this.query.skip = Expression.skip(0);\n        }\n\n        if (query.take != null && query.take.nodeName === \"take\") {\n            this.query.take = query.take;\n        } else {\n            this.query.take = Expression.take(Infinity);\n        }\n\n        if (query.include != null && query.include.nodeName === \"include\") {\n            this.query.include = query.include;\n        } else {\n            this.query.include = Expression.include();\n        }\n\n        if (query.orderBy != null && query.orderBy.nodeName === \"orderBy\") {\n            this.query.orderBy = query.orderBy;\n        } else {\n            this.query.orderBy = Expression.orderBy();\n        }\n    }\n\n    getExpression() {\n        return this.query;\n    }\n\n    getQuery() {\n        return this.query;\n    }\n\n    or(lambda) {\n        var rightExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            rightExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.Type));\n        } else if (lambda instanceof Expression) {\n            rightExpression = lambda;\n        } else {\n            throw new Error(\"Expected an expression to be supplied.\");\n        }\n\n        if (query.where.children.length === 0) {\n            query.where.children.push(rightExpression);\n        } else {\n            var leftExpression = query.where.children.pop();\n            query.where.children.push(Expression.or(leftExpression, rightExpression));\n        }\n\n        return this.copy(query);\n    }\n\n    where(lambda) {\n        var rightExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            rightExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.Type));\n        } else if (lambda instanceof Expression) {\n            rightExpression = lambda;\n        } else {\n            throw new Error(\"Expected an expression to be supplied.\");\n        }\n\n        if (query.where.children.length === 0) {\n            query.where.children.push(rightExpression);\n        } else {\n            var leftExpression = query.where.children.pop();\n            query.where.children.push(Expression.and(leftExpression, rightExpression));\n        }\n\n        return this.copy(query);\n    }\n\n    and(lambda) {\n        return this.where(lambda);\n    }\n\n    take(value) {\n        if (typeof value !== \"number\") {\n            throw new Error(\"Illegal Argument Exception: value needs to be a number.\");\n        }\n\n        var query = copyQuery(this.getQuery());\n        query.take = Expression.take(value);\n\n        return this.copy(query);\n    }\n\n    skip(value) {\n        if (typeof value !== \"number\") {\n            throw new Error(\"Illegal Argument Exception: value needs to be a number.\");\n        }\n\n        var query = copyQuery(this.getQuery());\n        query.skip = Expression.skip(value);\n\n        return this.copy(query);\n    }\n\n    orderByDesc(lambda) {\n        var propertyExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            propertyExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.Type)).getExpression();\n        } else if (lambda instanceof OperationExpressionBuilder) {\n            propertyExpression = lambda.getExpression();\n        } else {\n            throw new Error(\"Expected a property to orderByDesc.\");\n        }\n\n        var descendingExpression = Expression.descending(propertyExpression);\n\n        if (!query.orderBy.contains(propertyExpression)) {\n            query.orderBy.children.push(descendingExpression);\n            return this.copy(query);\n        } else {\n            return this;\n        }\n    }\n\n    orderBy(lambda) {\n        var propertyExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            propertyExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.Type)).getExpression();\n        } else if (lambda instanceof OperationExpressionBuilder) {\n            propertyExpression = lambda.getExpression();\n        } else {\n            throw new Error(\"Expected a property to orderBy.\");\n        }\n\n        var ascendingExpression = Expression.ascending(propertyExpression);\n\n        if (!query.orderBy.contains(propertyExpression)) {\n            query.orderBy.children.push(ascendingExpression);\n            return this.copy(query);\n        } else {\n            return this;\n        }\n    }\n\n    setParameters(params) {\n        if (!params) {\n            throw new Error(\"Expected parameters to be passed in.\");\n        }\n        var parameters = this.query.parameters;\n\n        Object.keys(params).forEach(function(key) {\n            parameters[key] = params[key];\n        });\n        return this;\n    }\n\n    withParameters(params) {\n        if (!params) {\n            throw new Error(\"Expected parameters to be passed in.\");\n        }\n\n        var parameters = (this.query.parameters = {});\n        Object.keys(params).forEach(function(key) {\n            parameters[key] = params[key];\n        });\n        return this;\n    }\n\n    include(lambda) {\n        var propertyExpression;\n        var query = copyQuery(this.getQuery());\n\n        if (typeof lambda === \"function\") {\n            lambda = lambda || function() {};\n            propertyExpression = lambda.call(ExpressionBuilder, new ExpressionBuilder(this.Type)).getExpression();\n        } else if (lambda instanceof OperationExpressionBuilder) {\n            propertyExpression = lambda.getExpression();\n        } else {\n            throw new Error(\"Expected a property to include.\");\n        }\n\n        if (propertyExpression.nodeName !== \"queryable\") {\n            propertyExpression = Expression.queryable(propertyExpression, Expression.expression(Expression.where()));\n        }\n\n        query.include.children.push(propertyExpression);\n        return this.copy(query);\n    }\n\n    merge(queryable) {\n        if (!(queryable instanceof Queryable)) {\n            throw new Error(\"Expected a queryable to be passed in.\");\n        }\n\n        var clone = this.copy();\n        var cloneQuery = clone.getQuery();\n        var query = queryable.getQuery();\n        var rightExpression = query.where.children[0];\n\n        if (rightExpression != null) {\n            // No need to copy if there is nothing to copy.\n            if (cloneQuery.where.children.length === 0) {\n                cloneQuery.where.children.push(rightExpression.copy());\n            } else if (cloneQuery.where.children.length === 1 && cloneQuery.where.children[0].nodeName === \"and\") {\n                cloneQuery.where.children[0].children.push(rightExpression.copy());\n            } else {\n                var leftExpression = cloneQuery.where.children.pop();\n                cloneQuery.where.children.push(Expression.and(leftExpression, rightExpression.copy()));\n            }\n        }\n\n        query.include.children.forEach(function(expression) {\n            cloneQuery.include.children.push(expression.copy());\n        });\n\n        query.orderBy.children.forEach(function(expression) {\n            if (!cloneQuery.orderBy.contains(expression)) {\n                cloneQuery.orderBy.children.push(expression.copy());\n            }\n        });\n\n        return this.copy(cloneQuery);\n    }\n\n    toArrayAsync() {\n        assertHasProvider(this);\n        return this.provider.executeAsync(this);\n    }\n\n    toGuid(value) {\n        return Expression.guid(Expression.constant(value));\n    }\n\n    forEachAsync(onEach) {\n        return this.toArrayAsync().then(function(results) {\n            results.forEach(onEach);\n            return results;\n        });\n    }\n\n    countAsync() {\n        assertHasProvider(this);\n        return this.provider.countAsync(this);\n    }\n\n    toArrayWithCountAsync() {\n        assertHasProvider(this);\n        return this.provider.toArrayWithCountAsync(this);\n    }\n\n    allAsync(lambda) {\n        assertHasProvider(this);\n        return this.provider.allAsync(this, lambda);\n    }\n\n    anyAsync(lambda) {\n        assertHasProvider(this);\n        return this.provider.anyAsync(this, lambda);\n    }\n\n    firstOrDefaultAsync(lambda) {\n        assertHasProvider(this);\n        return this.provider.firstOrDefaultAsync(this, lambda);\n    }\n\n    firstAsync(lambda) {\n        assertHasProvider(this);\n        return this.provider.firstAsync(this, lambda);\n    }\n\n    lastAsync(lambda) {\n        assertHasProvider(this);\n        return this.provider.lastAsync(this, lambda);\n    }\n\n    selectAsync(lambda) {\n        assertHasProvider(this);\n        return this.provider.selectAsync(this, lambda);\n    }\n\n    containsAsync(lambda) {\n        assertHasProvider(this);\n        return this.provider.containsAsync(this, lambda);\n    }\n\n    ifNone(callback) {\n        this.countAsync().then(function(count) {\n            if (count === 0) {\n                callback();\n            }\n        });\n\n        return this;\n    }\n\n    ifAny(callback) {\n        this.toArrayAsync(function(a) {\n            if (a.length > 0) {\n                callback(a);\n            }\n        });\n\n        return this;\n    }\n\n    intersectsAsync(compareToQueryable) {\n        assertHasProvider(this);\n        if (compareToQueryable instanceof Array) {\n            compareToQueryable = compareToQueryable.asQueryable();\n        }\n        return this.provider.intersectsAsync(this, compareToQueryable);\n    }\n\n    ofType(Type) {\n        var queryable = new Queryable(Type);\n        queryable.provider = this.provider;\n        return queryable;\n    }\n\n    copy(query) {\n        var queryable = new Queryable(this.Type, query || copyQuery(this.query));\n        queryable.provider = this.provider;\n        return queryable;\n    }\n}\n"]}