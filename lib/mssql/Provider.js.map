{"version":3,"sources":["../../src/mssql/Provider.js"],"names":["Provider","name","options","connectionPool","Error","edm","schema","entityBuilder","queryable","query","getQuery","visitor","statement","createSelectStatement","request","then","results","convert","count","countAsync","c","toArrayAsync","createSelectStatementWithCount","sqliteDatabase","get","result"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;;;IAEqBA,Q;AACjB,sBAAYC,IAAZ,EAAgC;AAAA,YAAdC,OAAc,uEAAJ,EAAI;;AAAA;;AAC5B,YAAIA,QAAQC,cAAR,IAA0B,IAA9B,EAAoC;AAChC,kBAAM,IAAIC,KAAJ,CAAU,iEAAV,CAAN;AACH;;AAED,YAAIF,QAAQG,GAAR,IAAe,IAAnB,EAAyB;AACrB,kBAAM,IAAID,KAAJ,CAAU,sDAAV,CAAN;AACH;;AAED,YAAIF,QAAQI,MAAR,IAAkB,IAAtB,EAA4B;AACxB,kBAAM,IAAIF,KAAJ,CAAU,wDAAV,CAAN;AACH;;AAED,aAAKC,GAAL,GAAWH,QAAQG,GAAnB;AACA,aAAKF,cAAL,GAAsBD,QAAQC,cAA9B;AACA,aAAKG,MAAL,GAAcJ,QAAQI,MAAtB;AACA,aAAKL,IAAL,GAAYA,IAAZ;;AAEA,aAAKM,aAAL,GAAqB,4BAAkBN,IAAlB,EAAwB,KAAKI,GAA7B,CAArB;AACH;;;;qCAEYG,S,EAAW;AAAA;;AACpB,gBAAIC,QAAQD,UAAUE,QAAV,EAAZ;AACA,gBAAIC,UAAU,sBAAY,KAAKV,IAAjB,EAAuB,KAAKI,GAA5B,EAAiC,KAAKC,MAAtC,CAAd;AACA,gBAAIM,YAAYD,QAAQE,qBAAR,CAA8BJ,KAA9B,CAAhB;;AAEA,mBAAO,KAAKN,cAAL,CAAoBW,OAApB,GAA8BL,KAA9B,CAAoCG,SAApC,EAA+CG,IAA/C,CAAoD,UAACC,OAAD,EAAa;AACpE,uBAAO,MAAKT,aAAL,CAAmBU,OAAnB,CAA2BD,OAA3B,CAAP;AACH,aAFM,CAAP;AAGH;;;8CAEqBR,S,EAAW;AAAA;;AAC7B,gBAAIU,QAAQ,CAAZ;AACA,mBAAO,KAAKC,UAAL,CAAgB,UAACC,CAAD,EAAO;AAC1BF,wBAAQE,CAAR;AACA,uBAAO,OAAKC,YAAL,CAAkBb,SAAlB,CAAP;AACH,aAHM,EAGJO,IAHI,CAGC,UAACC,OAAD,EAAa;AACjB,uBAAO;AACHE,2BAAOA,KADJ;AAEHF,6BAASA;AAFN,iBAAP;AAIH,aARM,CAAP;AASH;;;mCAEUR,S,EAAW;AAClB,gBAAIC,QAAQD,UAAUE,QAAV,EAAZ;AACA,gBAAIC,UAAU,sBAAY,KAAKV,IAAjB,EAAuB,KAAKI,GAA5B,EAAiC,KAAKC,MAAtC,CAAd;AACA,gBAAIM,YAAYD,QAAQW,8BAAR,CAAuCb,KAAvC,CAAhB;;AAEA,mBAAO,KAAKc,cAAL,CAAoBC,GAApB,CAAwBZ,SAAxB,EAAmCG,IAAnC,CAAwC,UAACU,MAAD,EAAY;AACvD,uBAAOA,OAAOP,KAAd;AACH,aAFM,CAAP;AAGH;;;;;;kBArDgBlB,Q","file":"Provider.js","sourcesContent":["import Visitor from \"./Visitor\";\nimport EntityBuilder from \"./EntityBuilder\";\n\nexport default class Provider {\n    constructor(name, options = {}) {\n        if (options.connectionPool == null) {\n            throw new Error(\"Null Argument Exception: connectionPool is required in options.\");\n        }\n\n        if (options.edm == null) {\n            throw new Error(\"Null Argument Exception: edm is required in options.\");\n        }\n        \n        if (options.schema == null) {\n            throw new Error(\"Null Argument Exception: schema is required in options\");\n        }\n\n        this.edm = options.edm;\n        this.connectionPool = options.connectionPool;\n        this.schema = options.schema;\n        this.name = name;\n\n        this.entityBuilder = new EntityBuilder(name, this.edm);\n    }\n\n    toArrayAsync(queryable) {\n        let query = queryable.getQuery();\n        let visitor = new Visitor(this.name, this.edm, this.schema);\n        let statement = visitor.createSelectStatement(query);\n\n        return this.connectionPool.request().query(statement).then((results) => {\n            return this.entityBuilder.convert(results);\n        });\n    }\n\n    toArrayWithCountAsync(queryable) {\n        let count = 0;\n        return this.countAsync((c) => {\n            count = c;\n            return this.toArrayAsync(queryable);\n        }).then((results) => {\n            return {\n                count: count,\n                results: results\n            }\n        })\n    }\n\n    countAsync(queryable) {\n        let query = queryable.getQuery();\n        let visitor = new Visitor(this.name, this.edm, this.schema);\n        let statement = visitor.createSelectStatementWithCount(query);\n\n        return this.sqliteDatabase.get(statement).then((result) => {\n            return result.count;\n        });\n    }\n}"]}