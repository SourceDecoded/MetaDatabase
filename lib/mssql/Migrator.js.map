{"version":3,"sources":["../../src/mssql/Migrator.js"],"names":["Migrator","iDb","schema","connectionPool","table","version","replace","edm","command","metaTable","getTable","options","tableName","builder","query","_getQualifiedDbTableName","createColumnDefinitionStatement","column","request","createTableStatement"],"mappings":";;;;;;;;AAAA;;;;;;;;IAEqBA,Q;AACjB,sBAAYC,GAAZ,EAAiB;AAAA;;AACb,aAAKC,MAAL,GAAcD,IAAIC,MAAlB;AACA,aAAKD,GAAL,GAAWA,GAAX;AACA,aAAKE,cAAL,GAAsBF,IAAIE,cAA1B;AACH;;;;iDAEwBC,K,EAAOC,O,EAAS;AACrC,yBAAW,KAAKH,MAAhB,WAA4BE,KAA5B,UAAsCC,QAAQC,OAAR,CAAgB,KAAhB,EAAuB,GAAvB,CAAtC;AACH;;;uCAEcC,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;;AAC9B,gBAAIC,YAAY,KAAKR,GAAL,CAASS,QAAT,CAAkBF,QAAQG,OAAR,CAAgBC,SAAlC,EAA6CR,KAA7D;AACA,gBAAIS,UAAU,oCAA0BJ,SAA1B,EAAqC;AAC/CF,qBAAKA,GAD0C;AAE/CL,wBAAQ,KAAKA;AAFkC,aAArC,CAAd;AAIA,gBAAIY,yBAAuB,KAAKC,wBAAL,CAA8BP,QAAQG,OAAR,CAAgBC,SAA9C,EAAyDL,IAAIF,OAA7D,CAAvB,UAAJ;AACAS,qBAASD,QAAQG,+BAAR,CAAwCR,QAAQG,OAAR,CAAgBM,MAAxD,CAAT;;AAEA,mBAAO,KAAKd,cAAL,CAAoBe,OAApB,GAA8BJ,KAA9B,CAAoCA,KAApC,CAAP;AACH;;;0CAEiBP,G,EAAmB;AACjC;;AADiC,gBAAdC,OAAc,uEAAJ,EAAI;AAEpC;;;qDAE4BD,G,EAAmB;AAC5C;;AAD4C,gBAAdC,OAAc,uEAAJ,EAAI;AAE/C;;;sDAE6BD,G,EAAmB;AAC7C;;AAD6C,gBAAdC,OAAc,uEAAJ,EAAI;AAEhD;;;sCAEaD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;;AAC7B,gBAAIJ,QAAQI,QAAQG,OAApB;AACA,gBAAIE,UAAU,oCAA0BT,KAA1B,EAAiC;AAC3CG,qBAAKA,GADsC;AAE3CL,wBAAQ,KAAKA;AAF8B,aAAjC,CAAd;AAIA,gBAAIY,QAAQD,QAAQM,oBAAR,EAAZ;;AAEA,mBAAO,KAAKhB,cAAL,CAAoBe,OAApB,GAA8BJ,KAA9B,CAAoCA,KAApC,CAAP;AACH;;;0CAEiBP,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACpC;;;6CAEoBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACvC;;;0DAEiCD,G,EAAkB;AAAA,gBAAbC,OAAa,uEAAH,EAAG;AACnD;;;2DAEkCD,G,EAAkB;AAAA,gBAAbC,OAAa,uEAAH,EAAG;AACpD;;;yCAEgBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACnC;;;0CAEiBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACpC;;;6CAEoBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACvC;;;yCAEgBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACnC;;;;;;kBApEgBR,Q","file":"Migrator.js","sourcesContent":["import TableStatementBuilder from \"./TableStatementBuilder\";\n\nexport default class Migrator {\n    constructor(iDb) {\n        this.schema = iDb.schema;\n        this.iDb = iDb;\n        this.connectionPool = iDb.connectionPool;\n    }\n\n    _getQualifiedDbTableName(table, version) {\n        return `[${this.schema}].[${table}__${version.replace(/\\./g, \"_\")}]`;\n    }\n\n    addColumnAsync(edm, command = {}) {\n        let metaTable = this.iDb.getTable(command.options.tableName).table;\n        let builder = new TableStatementBuilder(metaTable, {\n            edm: edm,\n            schema: this.schema\n        });\n        let query = `ALTER TABLE ${this._getQualifiedDbTableName(command.options.tableName, edm.version)} ADD `;\n        query += builder.createColumnDefinitionStatement(command.options.column);\n\n        return this.connectionPool.request().query(query);\n    }\n\n    addDecoratorAsync(edm, command = {}) {\n        // nothing to do here\n    }\n\n    addOneToOneRelationshipAsync(edm, command = {}) {\n        // nothing to do here\n    }\n\n    addOneToManyRelationshipAsync(edm, command = {}) {\n        // nothing to do here\n    }\n\n    addTableAsync(edm, command = {}) {\n        let table = command.options;\n        let builder = new TableStatementBuilder(table, {\n            edm: edm,\n            schema: this.schema\n        });\n        let query = builder.createTableStatement();\n\n        return this.connectionPool.request().query(query);\n    }\n\n    removeColumnAsync(edm, command = {}) {\n    }\n\n    removeDecoratorAsync(edm, command = {}) {\n    }\n\n    removeOneToOneRelationshipCommand(edm, command = {}){\n    }\n\n    removeOneToManyRelationshipCommand(edm, command = {}){\n    }\n\n    removeTableAsync(edm, command = {}) {\n    }\n\n    updateColumnAsync(edm, command = {}) {\n    }\n\n    updateDecoratorAsync(edm, command = {}) {\n    }\n\n    updateTableAsync(edm, command = {}) {\n    }\n}\n"]}