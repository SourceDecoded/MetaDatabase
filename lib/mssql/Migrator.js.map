{"version":3,"sources":["../../src/mssql/Migrator.js"],"names":["Migrator","iDb","schema","connectionPool","name","edm","options","metaTable","getTable","tableName","table","namer","builder","query","getQualifiedTableName","createColumnDefinitionStatement","column","request","createTableStatement","then","result"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;;;IAEqBA,Q;AACjB,sBAAYC,GAAZ,EAAiB;AAAA;;AACb,aAAKC,MAAL,GAAcD,IAAIC,MAAlB;AACA,aAAKD,GAAL,GAAWA,GAAX;AACA,aAAKE,cAAL,GAAsBF,IAAIE,cAA1B;AACA,aAAKC,IAAL,GAAY,eAAZ;AACH;;;;uCAEcC,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;;AAC9B,gBAAIC,YAAY,KAAKN,GAAL,CAASO,QAAT,CAAkBF,QAAQG,SAA1B,EAAqCC,KAArD;AACA,gBAAIC,QAAQ,8BAAoB,EAACN,KAAIA,GAAL,EAAUH,QAAO,KAAKA,MAAtB,EAApB,CAAZ;AACA,gBAAIU,UAAU,oCAA0BL,SAA1B,EAAqC;AAC/CF,qBAAKA,GAD0C;AAE/CH,wBAAQ,KAAKA;AAFkC,aAArC,CAAd;AAIA,gBAAIW,yBAAuBF,MAAMG,qBAAN,CAA4BR,QAAQG,SAApC,CAAvB,UAAJ;AACAI,qBAASD,QAAQG,+BAAR,CAAwCT,QAAQU,MAAhD,CAAT;;AAEA,mBAAO,KAAKb,cAAL,CAAoBc,OAApB,GAA8BJ,KAA9B,CAAoCA,KAApC,CAAP;AACH;;;0CAEiBR,G,EAAmB;AACjC;;AADiC,gBAAdC,OAAc,uEAAJ,EAAI;AAEpC;;;qDAE4BD,G,EAAmB;AAC5C;;AAD4C,gBAAdC,OAAc,uEAAJ,EAAI;AAE/C;;;sDAE6BD,G,EAAmB;AAC7C;;AAD6C,gBAAdC,OAAc,uEAAJ,EAAI;AAEhD;;;sCAEaD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;;AAC7B,gBAAII,QAAQJ,OAAZ;AACA,gBAAIM,UAAU,oCAA0BF,KAA1B,EAAiC;AAC3CL,qBAAKA,GADsC;AAE3CH,wBAAQ,KAAKA;AAF8B,aAAjC,CAAd;AAIA,gBAAIW,QAAQD,QAAQM,oBAAR,EAAZ;;AAEA,mBAAO,KAAKf,cAAL,CAAoBc,OAApB,GAA8BJ,KAA9B,CAAoCA,KAApC,EAA2CM,IAA3C,CAAgD,UAACC,MAAD,EAAY;AAC/D,uBAAO,EAAP;AACH,aAFM,CAAP;AAGH;;;0CAEiBf,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACpC;;;6CAEoBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACvC;;;0DAEiCD,G,EAAkB;AAAA,gBAAbC,OAAa,uEAAH,EAAG;AACnD;;;2DAEkCD,G,EAAkB;AAAA,gBAAbC,OAAa,uEAAH,EAAG;AACpD;;;yCAEgBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACnC;;;0CAEiBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACpC;;;6CAEoBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACvC;;;yCAEgBD,G,EAAmB;AAAA,gBAAdC,OAAc,uEAAJ,EAAI;AACnC;;;;;;kBApEgBN,Q","file":"Migrator.js","sourcesContent":["import TableStatementBuilder from \"./TableStatementBuilder\";\nimport TableNameHelper from \"./TableNameHelper\";\n\nexport default class Migrator {\n    constructor(iDb) {\n        this.schema = iDb.schema;\n        this.iDb = iDb;\n        this.connectionPool = iDb.connectionPool;\n        this.name = \"MsSqlMigrator\";\n    }\n\n    addColumnAsync(edm, options = {}) {\n        let metaTable = this.iDb.getTable(options.tableName).table;\n        let namer = new TableNameHelper({edm:edm, schema:this.schema});\n        let builder = new TableStatementBuilder(metaTable, {\n            edm: edm,\n            schema: this.schema\n        });\n        let query = `ALTER TABLE ${namer.getQualifiedTableName(options.tableName)} ADD `;\n        query += builder.createColumnDefinitionStatement(options.column);\n\n        return this.connectionPool.request().query(query);\n    }\n\n    addDecoratorAsync(edm, options = {}) {\n        // nothing to do here\n    }\n\n    addOneToOneRelationshipAsync(edm, options = {}) {\n        // nothing to do here\n    }\n\n    addOneToManyRelationshipAsync(edm, options = {}) {\n        // nothing to do here\n    }\n\n    addTableAsync(edm, options = {}) {\n        let table = options;\n        let builder = new TableStatementBuilder(table, {\n            edm: edm,\n            schema: this.schema\n        });\n        let query = builder.createTableStatement();\n\n        return this.connectionPool.request().query(query).then((result) => {\n            return [];\n        });\n    }\n\n    removeColumnAsync(edm, options = {}) {\n    }\n\n    removeDecoratorAsync(edm, options = {}) {\n    }\n\n    removeOneToOneRelationshipCommand(edm, options = {}){\n    }\n\n    removeOneToManyRelationshipCommand(edm, options = {}){\n    }\n\n    removeTableAsync(edm, options = {}) {\n    }\n\n    updateColumnAsync(edm, options = {}) {\n    }\n\n    updateDecoratorAsync(edm, options = {}) {\n    }\n\n    updateTableAsync(edm, options = {}) {\n    }\n}\n"]}